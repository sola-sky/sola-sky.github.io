---
title: 手势事件被重叠的下层消费解决思路
date: 2016-05-29 17:56:07
tags:
---

最近在仿造网易云音乐app的底部弹出框效果，实际开发中遇到了一个问题，就是当手势事件按在上层时（本文中说的上层和下层是同级关系的ViewGroup，例如DrawLayout中的两个子布局），由于上层的子view和其本身ViewGroup都没有消费事件，所以touchEvent被传到下层进行消费了（由于上层从底部弹出来覆盖在了下层之上，所以区域重叠了）。
但是我想要的顺序不是这样的，我想要是事件没有被上层消费时，直接让其parent View消费，而不是传给下层。一开始以为DrawLayout有实现，然后傻傻的看源码，最后通过实践写了一个DrawLayout的activity，发现也一样，事件也是被下层消费了。
然后现在想了一个办法，拖拽事件我只想让TextView被按下时才触发，TextView下面的ListView按照其原来的方式消费touchEvent。所以在最顶层ViewGroup（类似DrawLayout）中拦截事件时进行判断，如果手指按在了TextView区域内，则拦截事件，不让其往子view传递事件，这样事件就会传到最顶层自己的onTouchEvent中了，这样就可以实现拖拽，而不是被下层view消费了。
还有为了阻止事件传递给下层，可以为上层添加`clickable=true`这个属性，这个属性一添加，事件如果没有被其子View消费，那么就会被自己消费，虽然啥都没写，但是其onTouchEvent会返回true，这样就可以阻止事件继续传递，于是就不会传给下层了，但同时也不会传给其parent View也就是自定义的那个底部弹出框布局。但是前面我们已经为按到TextView时的事件进行拦截，所以自定义底部弹出框依然是可以拖拽的，只要你按到了TextView，其他区域不需要拖拽，其他区域只要正常消费事件就行了，因为其他区域就只有一个可以上下拉进行数据加载的Listview。
**补充一下，ViewDragHelper里的getViewHorizontalDragRange()必须返回0，否则在进行滑动时，自定义底部弹出框会阻止事件往子View传递，于是上下拉加载数据操作就无法实现了**